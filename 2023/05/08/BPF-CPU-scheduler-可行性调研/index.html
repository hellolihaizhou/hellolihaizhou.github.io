<!DOCTYPE html>
<html lang="zh-Hans">
    <!-- title -->


    

<!-- keywords -->



<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Steven Li">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Steven Li">
    
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="愿历尽千帆 归来仍少年">
    <meta name="description" content="本文将主要涉及如下内容 1.解读 邮件内容  摘取其中的关键内容，尽量将围绕这个话题的关键讨论以时间线展示。 2.介绍Google 的GhOSt 开源框架 同时会穿插一些额外的内容(比如GKI 的基础介绍、OEM 的定制修改) 以便于更好的理解 关于BPF scheduler 的邮件讨论将BPF 引入CPU  scheduler，业内有过一些讨论，涉及到的主要人物  Roman Gushchin">
<meta property="og:type" content="article">
<meta property="og:title" content="BPF | CPU scheduler 可行性调研">
<meta property="og:url" content="http://lihaizhou.top/2023/05/08/BPF-CPU-scheduler-可行性调研/index.html">
<meta property="og:site_name" content="李海洲">
<meta property="og:description" content="本文将主要涉及如下内容 1.解读 邮件内容  摘取其中的关键内容，尽量将围绕这个话题的关键讨论以时间线展示。 2.介绍Google 的GhOSt 开源框架 同时会穿插一些额外的内容(比如GKI 的基础介绍、OEM 的定制修改) 以便于更好的理解 关于BPF scheduler 的邮件讨论将BPF 引入CPU  scheduler，业内有过一些讨论，涉及到的主要人物  Roman Gushchin">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.lihaizhou.top/BPF-scheduler/BPF-scheduler1.png">
<meta property="og:image" content="http://blog.lihaizhou.top/BPF-scheduler/BPF-scheduler2.png">
<meta property="og:updated_time" content="2023-05-09T01:40:52.101Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BPF | CPU scheduler 可行性调研">
<meta name="twitter:description" content="本文将主要涉及如下内容 1.解读 邮件内容  摘取其中的关键内容，尽量将围绕这个话题的关键讨论以时间线展示。 2.介绍Google 的GhOSt 开源框架 同时会穿插一些额外的内容(比如GKI 的基础介绍、OEM 的定制修改) 以便于更好的理解 关于BPF scheduler 的邮件讨论将BPF 引入CPU  scheduler，业内有过一些讨论，涉及到的主要人物  Roman Gushchin">
<meta name="twitter:image" content="http://blog.lihaizhou.top/BPF-scheduler/BPF-scheduler1.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    
        <link rel="alternate" href="/atom.xml" title="愿历尽千帆 归来仍少年" type="application/atom+xml">
    
    <title>BPF | CPU scheduler 可行性调研 · 李海洲</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20210823" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20210823" as="style">
    <link rel="stylesheet" href="/css/dark.css" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="/css/mobile.css?v=20210823" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20210823" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20210823" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin="">
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin="">
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>愿历尽千帆 归来仍少年</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">愿历尽千帆 归来仍少年</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">BPF | CPU scheduler 可行性调研</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                BPF | CPU scheduler 可行性调研
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">4,506</span>阅读时长: <span class="post-count reading-time">20 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2023/05/08</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <p>本文将主要涉及如下内容</p>
<p>1.解读<bpf scheduler=""> 邮件内容<br>  摘取其中的关键内容，尽量将围绕这个话题的关键讨论以时间线展示。</bpf></p>
<p>2.介绍Google 的GhOSt 开源框架</p>
<p>同时会穿插一些额外的内容(比如GKI 的基础介绍、OEM 的定制修改) 以便于更好的理解</p>
<h3 id="关于BPF-scheduler-的邮件讨论"><a href="#关于BPF-scheduler-的邮件讨论" class="headerlink" title="关于BPF scheduler 的邮件讨论"></a>关于BPF scheduler <strong>的邮件讨论</strong></h3><p>将BPF 引入<code>CPU  scheduler</code>，业内有过一些讨论，涉及到的主要人物</p>
<ul>
<li><code>Roman Gushchin</code>  Facebook ，内核调度策略中加入BPF 基础设施的owner</li>
<li><code>Hao Luo</code>         Google，开源框架ghOSt 的owner，还有一个owner <code>Barret Rhoden</code></li>
<li><code>Qais Yousef</code>     ARM，针对Roman 的patchSet 提出一系列关于移动端的疑问</li>
<li><code>Ren Zhijie</code>      华为，  在<code>Roman</code> 的PatchSet 基础上做了二次开发</li>
</ul>
<p>故事的开始是Facebook 的<code>Roman Gushchin</code> 致力于想要将这笔<a href="https://lwn.net/ml/linux-kernel/20210916162451.709260-1-guro@fb.com/" target="_blank" rel="noopener">Scheduler BPF</a> 合入到内核主线中 ，对于该PatchSet 的目的他本人给出的理由：</p>
<blockquote>
<p>This patchset aims to start a discussion about potential applications of BPF to the scheduler. <strong>It also aims to land some very basic BPF infrastructure necessary to add new BPF hooks to the scheduler</strong>, a minimal set of useful helpers, corresponding libbpf changes, etc.</p>
</blockquote>
<p>本补丁集旨在启动关于将 BPF 应用于调度器的潜在应用讨论，它还旨在实现一些非常基本的 BPF 基础设施，以添加新的 BPF 钩子到调度器，提供一组最小的实用程序，对应的 libbpf 更改等。</p>
<p>同时<code>Roman Gushchin</code> 提到了目前这笔PatchSet 实测效果以及谷歌也正在做类似的事情</p>
<blockquote>
<p>Our very first experiments with using BPF in CFS look very promising. We’re at a very early stage, however already have seen a nice latency and ~1% RPS wins for our (Facebook’s) main web workload.</p>
<p>As I know, Google is working on a more radical approach [2]: they aim to move the scheduling code into userspace. It seems that their core motivation is somewhat similar: to make the scheduler changes easier to develop, validate and deploy. Even though their approach is different, they also use BPF for speeding up some hot paths. I think the suggested infrastructure can serve their purpose too.</p>
</blockquote>
<p>我们在 CFS 中使用 BPF 的第一个实验看起来非常有前途。虽然还处于早期阶段，但已经看到了对我们（Facebook）的主要 Web 工作负载产生的良好延迟和约 1% 的请求秒数优化。</p>
<p>据我所知，谷歌正在进行一种更激进的方法[2]：<strong>他们的目标是将调度代码移动到用户空间</strong>，看起来他们的核心动机也有些类似：</p>
<p><strong>使调度器的更改更易于开发，验证和部署。即使他们的方法不同，他们也使用 BPF 来加速一些热点路径，我认为所提供的基础设施也可以为他们的目的服务。</strong></p>
<p>额外补充：</p>
<p>这里<code>Roman Gushchin</code> 说的“他们的目标是将调度代码移动到用户空间”，容易让人误解，应该指的是调度的决策代码挪到了用户空间。事实上Google 的GhOSt 实际调度运行代码是在BPF 中实现的，运行在内核中，如果真的将调度代码挪到用户空间，那将引起大量的用户/内核之间的切换。</p>
<p>对于<code>Roman Gushchin</code> 上面邮件的内容</p>
<p>Google GhOSt  Owner <code>Hao Luo</code>  于15 Sep 2021 在邮件中回复到：</p>
<blockquote>
<p>Yes. Barret can talk more about this, but I think it summarized the work of ghOSt [3] and the use of BPF in ghOSt well. Looking forward, I agree that BPF has a great potential in customizing policies in the scheduler. It has the advantage of quick experimentation and deployment. One of the use cases I’m thinking of is to customize load balancing policies. For example, allow using BPF to influence whether a task can migrate (can_migrate_task). This is currently only an idea.</p>
</blockquote>
<p>没错，谷歌的开源框架ghOSt (<a href="https://lpc.events/event/11/contributions/954/" target="_blank" rel="noopener">Use of eBPF in cpu scheduler</a>) 正是利用BPF 实现了定制调度策略。</p>
<p>展望未来，我同意 BPF 对于定制化调度器策略有着巨大的潜力，它具有快速实验和部署的优势。我正在考虑其中一种用例，那就是定制负载平衡策略。</p>
<p>例如，可以使用 BPF 来影响一个任务是否可以迁移（can_migrate_task），这目前只是一个想法。</p>
<p>当天(15 Sep 2021) 晚些时候，<code>Roman Gushchin</code> 邮件回复了<code>Hao Luo</code></p>
<blockquote>
<p>I took a brief look over how you use BPF in ghOSt and I think what I suggest will work for you as well. I’d appreciate any comments/feedback whether it’s definitely true.</p>
</blockquote>
<p>我大致看了下你们用BPF 实现的ghOSt 框架，相信我的这笔patchSet 同样能够达到你们的目的。</p>
<p><code>Roman Gushchin</code> 和 <code>Hao Luo</code> 的邮件讨论，引起了来自ARM 的<code>Qais Yousef</code> 的注意</p>
<p><code>Yousef</code>于06 Oct 2021 回复了该主题的邮件，并提出了自己担忧</p>
<blockquote>
<p>I am (very) wary of these hooks. Scheduler (in mobile at least) is an area that gets heavily modified by vendors and OEMs. We try very hard to understand the problems they face and get the right set of solutions in mainline. Which would ultimately help towards the goal of having a single Generic kernel Image [1] that gives you what you’d expect out of the platform without any need for additional cherries on top. So my worry is that this will open the gate for these hooks to get more than just micro-optimization done in a platform specific way. And that it will discourage having the right discussion to fix real problems in the scheduler because the easy path is to do whatever you want in userspace. I am not sure we can control how these hooks are used.</p>
<p>The question is: why can’t we fix any issues in the scheduler/make it better and must have these hooks instead?</p>
</blockquote>
<p>我对这些钩子的引入非常担忧，调度器（至少在移动端）是一个被供应商和OEM大量客制化的领域。</p>
<p>我们非常努力地了解他们面临的问题，并在主线中获得正确的解决方案。这最终将有助于实现GKI 目标。所以，我担心这笔patchSet 一旦引入，内核将无法控制用户空间的行为。</p>
<p>问题是：</p>
<p><strong>为什么我们不能在内核主线中解决调度器中遇到的问题并使其更好，而非要使用这些钩子？</strong></p>
<p>同时，<code>Yousef</code> 提出如果要用钩子的话，最好要合入内核，这将使大家都能用得上，也方便以后追溯合入的原因，以及方便在不需要的时候移除。</p>
<p>额外补充：</p>
<p>这里说下OEM 客制化调度器这件事，社区一直在尝试解读OEM 的补丁修改，试图理解他们修改背后的动机，以便后续在主线内核中修复这些问题，同时摘取了一些OEM 的修改进行了性能测试验证。</p>
<p>详细可以阅读这篇文章 &lt;<a href="https://lwn.net/Articles/820825/" target="_blank" rel="noopener">Evaluating vendor changes to the scheduler</a>&gt;</p>
<p>另外，既然这里Yousef  提到了Android 的GKI，我们再简单的介绍下Google 对于ACK 后续的规划</p>
<p><img src="http://blog.lihaizhou.top/BPF-scheduler/BPF-scheduler1.png" alt="Untitled"></p>
<p>从上图可以看出，谷歌的目标是Android 通用内核 (ACK) 尽量贴近上游，所以后续对于内核的修改，厂商必须优先使用 Linux 内核邮件列表 (LKML) 向上游提交代码更改，并且只有在有充分理由说明上游不可行时才将代码更改提交到 ACK <code>android-mainline</code>分支。</p>
<p>如因修改不通用无法被上游采纳，并且没有打算重构下再提交到上游的计划，同样不会被ACK 采纳。</p>
<p>合入到上游这点很难，因为需要明确的案例说明这个修改是有帮助的。尤其是调度以及内存相关的修改，社区态度一向十分谨慎，然而很多手机厂商的客制化修改其实并非通用且多是策略优化 + 性能数据采集。</p>
<p>GKI 相关资料：</p>
<ol>
<li><a href="https://source.android.com/devices/architecture/kernel/kernel-code?hl=zh-cn#changes-to-gki-defconfig" target="_blank" rel="noopener">为 GKI 开发内核代码</a></li>
<li><a href="https://android.googlesource.com/kernel/common/+/refs/heads/android-mainline/README.md" target="_blank" rel="noopener">如何向 Android 通用内核提交补丁</a></li>
<li><a href="https://source.android.com/docs/core/architecture/kernel/android-common?hl=zh-cn" target="_blank" rel="noopener">Android 通用内核</a></li>
</ol>
<p>再继续回到邮件讨论上，对于<code>Yousef</code>的担忧，<code>Roman Gushchin</code> 在隔了几天后(11 Oct 2021) 回复了邮件：</p>
<blockquote>
<p>I think a relatively small and stable set of hooks can cover a large percent of potential customization ideas.</p>
</blockquote>
<p><code>Roman</code>认为提供一套小的且稳定的hooks，可以满足大部分的定制需求</p>
<blockquote>
<p>Shipping a custom kernel (actually any kernel) at this scale isn’t easy or fast.<br>Just for example, imagine a process of rebooting of a 1000000 machines running<br>1000’s different workloads, each with their own redundancy and capacity requirements.</p>
</blockquote>
<p>同时<code>Roman</code>解释了如果在内核主线上修改的话，修改以及重新部署内核的成本比较高，如果能够通过用户空间推送修改，这样可以节省不少的成本。</p>
<p>第二天(12 Oct 2021) <code>Yousef</code> 回复了<code>Roman Gushchin</code> 的邮件：</p>
<blockquote>
<p>I think you’re still referring to ghOSt here. I thought your 2 use cases are different as you mentioned they “completely move the scheduler code into userspace/bpf”; but it could be just me mis-interpreting what this means. That didn’t read to me they want to micro-optimize (few) certain decisions in the scheduler, rather replace it altogether, hence my question.</p>
</blockquote>
<blockquote>
<p>Anyway. My 2cents here is that we should be careful not to introduce something that encourages out-of-tree workarounds for real scheduler problems nor have it done in a way where we lose visibility over how these hooks are used and being able to share it with others who could benefit from the same mico-optimization too.</p>
</blockquote>
<p>这段不太好直接翻过来，根据个人理解下来<code>Yousef</code> 表达的大意是：</p>
<p>无论是优化还是移植，我们都需要小心，以免引入一些可能导致未来出现真正调度问题却绕过内核的解决方案。同时，我们还需要确保我们在使用调度钩子时具有完整的可见性和透明性，以便将这些经验分享给其他人，让更多人从这些优化中受益。如果我们失去了这些调度钩子的可见性和透明性，可能会导致很多人错过这些优化，或者可能会出现一些我们无法预知的复杂调度问题。</p>
<p>至此，关于该主题的邮件讨论平息了一段时间</p>
<p><code>Yafang Shao</code> 在一个月后(25 Nov 2021) 回复<code>Roman</code></p>
<blockquote>
<p>Scheduler BPF is a great idea. Thanks for the work.<br>Scheduler BPF won’t be a small feature,  I think we’d better give a summary of possible hooks it may add first.<br>We must have a <em>basic rule</em> to control what it will tend to be to avoid adding BPF hooks here and there.<br>I haven’t found a clear rule yet, but maybe we can learn it from netfilter, which has 5 basic hooks.<br>Regarding the scheduler BPF hooks, some possible basic hooks may be:</p>
<ul>
<li>Hook for Enqueue</li>
<li>Hook for Dequeue</li>
<li>Hook for Put Prev Task</li>
<li>Hook for Set Next Task</li>
</ul>
</blockquote>
<p>BPF 调度是一个不错的想法，并且不是一个小功能，建议先想下都有哪些地方需要加钩子，可以学习下netfilter 模块(有5个基本的钩子)，而调度这块可能会涉及到的钩子如Enqueue、Dequeue、Put Prev Task、Set Next Task等。</p>
<p><code>Roman</code> 次日(26 Nov 2021 )回复了<code>Yafang Shao</code>：</p>
<blockquote>
<p>I think it depends on what we want to achieve. There are several options:<br>we might aim to implement the whole scheduler logic in bpf, we might aim<br>to do some adjustments to the existing scheduler behavior or a mix of those<br>approaches.</p>
</blockquote>
<p>对于<code>Yafang Shao</code> 前面提到的这个功能不是一个小功能，<code>Roman</code> 认为这取决于我们想要达到什么样的效果</p>
<p>目前有如下几种选择</p>
<ol>
<li>在BPF中实现整个调度逻辑</li>
<li>对现有的调度基础上进行一些调整</li>
<li>混合使用这些方法</li>
</ol>
<p><code>Roman</code> 接着说到：</p>
<blockquote>
<p>Bpf as now is now is not capable enough to implement a new scheduler class without a substantial amount of new c code (in form of helpers, maybe custom maps, some verifier changes etc). In particular, it’s a challenging to provide strong safety guarantees: any scheduler bpf program loaded shouldn’t crash or deadlock the system (otherwise bpf isn’t any better than a kernel module). Also performance margins are quite tight.</p>
</blockquote>
<p>在当前的情况下，BPF现在还不足以在不添加大量新的C代码（比如帮助程序、自定义映射、一些验证程序的更改等）的情况下实现一个完全新的调度类。</p>
<p>特别是，要提供强有力的安全保障是一项挑战性的任务：任何加载的调度BPF程序都不应该使系统崩溃或死锁（否则BPF与内核模块的效果就没什么区别了），此外，性能表现非常重要。</p>
<blockquote>
<p>I’m not saying that providing such generic hooks is impossible or useless, but it requires a lot of changes and support code and I’m not sure that we have a good justification for them right now.<br>I think instead we might want to see bpf hooks as a better form of (sysctl) tunables, which are more flexible (e.g. can be used for specific processes, cgroups, cpus, being enabled depending on load, weather, etc) and do not create an ABI (so are easier to maintain).</p>
</blockquote>
<p>我们可能希望将bpf hooks 视为更好的（sysctl）可调参数的形式，这些参数更加灵活（例如可以用于特定进程、cgroup、CPU，根据负载、weather 等情况启用），并且不会创建ABI（因此更易于维护）。</p>
<p>再过去了大半年后(19 Jul 2022)，华为的的<code>Ren Zhijie</code> 回复了该主题邮件</p>
<blockquote>
<p>We want to implement a programmable scheduler to meet the schedule requirements of different workloads.<br>Using BPF, we can easily deploy schedule policies for specific workloads, quickly verifying without modifying the kernel code.<br>This greatly reduces the cost of deploying new schedule policies in the production environment.<br>Therefore, we want to continue to develop based on your patch. <strong>We plan to merge it into the openeuler open-source community and use the community to continuously evolve and maintain it</strong>.(link: <a href="https://www.openeuler.org/en/" target="_blank" rel="noopener">https://www.openeuler.org/en/</a>)</p>
</blockquote>
<p><code>Ren Zhijie</code> 开头先说了下BPF 定制调度能够快速部署，修改便利等，相比之前节省了成本，同时提出了他们正打算利用BPF 实现一个可编程调度器以应对不同的负载情况。</p>
<p>并打算在<code>Roman</code> 的patchSet 基础上进行修改，后面会贡献给openeuler  开源社区。</p>
<p>同时，<code>Ren Zhijie</code> 说明了他们做了哪些额外的修改</p>
<blockquote>
<p>We made some changes to your patch:</p>
<ol>
<li>Adapt to the openeuler-OLK-5.10 branch, which mostly base on linux<br>longterm branch 5.10.</li>
<li>Introduce the Kconfig CONFIG_BPF_SCHED to isolate related code at<br>compile time.</li>
<li>helpers bpf_sched_entity_to_cgrpid() and bpf_sched_entity_belongs_to_cgrp() are modified to obtain the task group to which the sched entity belongs through se-&gt;my_q-&gt;tg-&gt;css.cgroup.</li>
</ol>
<p>We have some ideas for the next iteration of Scheduler BPF that we would like to share with you:</p>
<ol>
<li>The tag field is added to struct task_struct and struct task_group. Users can use the file system interface to mark different tags for specific workloads. The bpf prog obtains the tags to detect different workloads.</li>
<li>Add BPF hook and helper to scheduling processes such as select_task_rq and pick_next_task to enable scalability.</li>
</ol>
<p><strong>It’s a new attempt, and there’s bound to be a lot of problems later, but it’s exciting that it makes the schduler programmable.</strong></p>
</blockquote>
<p>当天晚些时候，<code>Roman</code> 回复了<code>Ren Zhijie</code>：</p>
<blockquote>
<p>Great to hear my work is useful and thank you for describing your plans!<br>I’m not actively working on it right now, but I might start again in the future.<br>Let me know if I can help you with this effort.</p>
</blockquote>
<p>很高兴我的PatchSet 给你带来了帮助，不过我现在没在搞这个，后面可能会再捡起来继续搞。</p>
<p><code>Roman Gushchin</code> 的patchSet 内容比较多，可以从下面的PATCH rfc 1/6 慢慢看起</p>
<p><a href="https://lwn.net/ml/linux-kernel/20210916162451.709260-2-guro@fb.com/" target="_blank" rel="noopener">https://lwn.net/ml/linux-kernel/20210916162451.709260-2-guro@fb.com/</a></p>
<p>另外关于BPF 调度的一个示例简单 Demo ：<a href="https://github.com/rgushchin/atc" target="_blank" rel="noopener">https://github.com/rgushchin/atc</a></p>
<p>这个Demo 中包含三个hook 点，在<code>Roman Gushchin</code> 的patchSet 中同样涉及这三个</p>
<p><code>cfs_check_preempt_tic</code>、<code>cfs_check_preempt_wakeup</code>、<code>cfs_wakeup_preempt_entity</code></p>
<p>关于这三个hook 点的说明</p>
<ol>
<li><p>The first one allows to force or suppress a preemption from a tick context.<br>An obvious usage example is to minimize the number of non-voluntary context switches and decrease an associated latency penalty by (conditionally) providing tasks or task groups an extended execution slice.<br>It can be used instead of tweaking sysctl_sched_min_granularity.</p>
</li>
<li><p>The second one is called from the wakeup preemption code and allows to redefine whether a newly woken task should preempt the execution of the current task. This is useful to minimize a number of preemptions of latency sensitive tasks.<br>To some extent it’s a more flexible analog of a sysctl_sched_wakeup_granularity.</p>
</li>
<li><p>The third one is similar, but it tweaks the wakeup_preempt_entity() function, which is called not only from a wakeup context, but also from pick_next_task(), which allows to influence the decision on which task will be running next.</p>
</li>
</ol>
<h3 id="Google-开源框架ghOSt"><a href="#Google-开源框架ghOSt" class="headerlink" title="Google 开源框架ghOSt"></a>Google 开源框架ghOSt</h3><blockquote>
<p>ghOSt is a general-purpose delegation of scheduling policy implemented on top of the Linux kernel. The ghOSt framework provides a rich API that receives scheduling decisions for processes from userspace and actuates them as transactions. Programmers can use any language or tools to develop policies, which can be upgraded without a machine reboot. ghOSt supports policies for a range of scheduling objectives, from µs-scale latency, to throughput, to energy efficiency, and beyond, and incurs low overheads for scheduling actions. Many policies are just a few hundred lines of code. Overall, ghOSt provides a performant framework for delegation of thread scheduling policy to userspace processes that enables policy optimization, non-disruptive upgrades, and fault isolation.</p>
</blockquote>
<p>ghOSt 是一个通用的Linux内核调度策略委托工具，它提供了丰富的API，可以从用户空间接收进程调度决策并将它们作为交易来实施。</p>
<p>开发人员可以使用任何编程语言或工具来编写策略，并且可以在不重启机器的情况下进行升级。ghOSt支持多种调度目标，包括微秒级延迟、吞吐量、能源效率等，并且对调度操作的开销很小。</p>
<p>许多策略只需要几百行代码就可以实现。总的来说，ghOSt为将线程调度策略委托给用户空间进程提供了一个高性能的框架，可以实现策略优化、非破坏性升级和故障隔离。</p>
<p>如果说<code>Roman Gushchin</code> 的patchSet 是在内核中提供BPF 基础设施，那么Google 的ghOSt 则看起来是一整套框架(user + kernel)，一套完整的调度策略(和CFS 共存，优先级低于CFS)。</p>
<p>目前已在Google search 和snap 上落地，且有不错的性能测试数据，按paper 中的性能测试数据来看的话ghOSt 的调度开销只比现有的内核调度器略高。</p>
<p>Paper 中摘取一段Google 针对ghOSt  的性能测试图表</p>
<p>Linux 4.15 with our ghOSt patches applied.We run microbenchmarks on a 2-socket Intel Xeon Platinum 8173M @ 2GHz, 28 cores per socket, 2 logical cores each.</p>
<p><img src="http://blog.lihaizhou.top/BPF-scheduler/BPF-scheduler2.png" alt="Untitled"></p>
<p>关于ghOSt 的资料：</p>
<ol>
<li><a href="https://lpc.events/event/16/contributions/1365/attachments/986/1912/lpc22-ebpf-kernel-scheduling-with-ghost.pdf" target="_blank" rel="noopener">eBPF Kernel Scheduling with Ghost</a>  Google <code>Barret Rhoden</code> 2022.09.12 的PPT</li>
<li><a href="https://github.com/google/ghost-kernel" target="_blank" rel="noopener">https://github.com/google/ghost-kernel</a> kernel 源码，基于Linux 5.11</li>
<li><a href="https://github.com/google/ghost-userspace" target="_blank" rel="noopener">https://github.com/google/ghost-userspace</a> userspace 源码</li>
<li><a href="https://netdevconf.info/0x15/papers/25/ghOSt.pdf" target="_blank" rel="noopener">paper</a>  非常详细的技术细节解读，同时含有性能测试数据，看不动了内容太多</li>
<li><a href="https://www.youtube.com/watch?v=auen1MpxxGY&amp;list=PLrninrcyMo3L-hsJv23hFyDGRaeBY1EJO" target="_blank" rel="noopener">video</a>   可以结合着PPT 看</li>
</ol>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>Google 的ghOSt  框架已经有实际落地项目(snap + search)，用户空间和内核代码都现成的，甚至测试工具都备好了，不过没看到有介绍说落地在Android 设备上，如果要用ghOSt  的话，不知道是否能够应用在移动端，需要阅读<a href="https://netdevconf.info/0x15/papers/25/ghOSt.pdf" target="_blank" rel="noopener">paper</a> 并结合源码。</p>
<p>而Roman 的patchSet 则是提供了一组内核的基础设施，个人理解以Roman 的patchSet 入手先进行微小的实践(比如结合这个demo：<a href="https://github.com/rgushchin/atc)或许是一个不错的开始。" target="_blank" rel="noopener">https://github.com/rgushchin/atc)或许是一个不错的开始。</a></p>

    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="http://lihaizhou.top">Steven Li</a>
            <p>原文链接：<a href="http://lihaizhou.top/2023/05/08/BPF-CPU-scheduler-可行性调研/">http://lihaizhou.top/2023/05/08/BPF-CPU-scheduler-可行性调研/</a>
            <p>发表日期：<a href="http://lihaizhou.top/2023/05/08/BPF-CPU-scheduler-可行性调研/">May 8th 2023, 5:41:33 pm</a>
            <p>更新日期：<a href="http://lihaizhou.top/2023/05/08/BPF-CPU-scheduler-可行性调研/">May 9th 2023, 9:40:52 am</a>
            <p>版权声明：本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2023/04/25/Userfaultfd-在-ART-GC-上的应用/" title="Userfaultfd 在 ART GC 上的应用">
                    <div class="prevTitle">Userfaultfd 在 ART GC 上的应用</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:hellolihaizhou@163.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                    
                    <img class="profile-qr" src="/assets/wechat.jpg" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#关于BPF-scheduler-的邮件讨论"><span class="toc-number">1.</span> <span class="toc-text">关于BPF scheduler 的邮件讨论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Google-开源框架ghOSt"><span class="toc-number">2.</span> <span class="toc-text">Google 开源框架ghOSt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">3.</span> <span class="toc-text">小结</span></a></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 30
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/08</span>
            <a class="archive-post-title" href="/2023/05/08/BPF-CPU-scheduler-可行性调研/">BPF | CPU scheduler 可行性调研</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/25</span>
            <a class="archive-post-title" href="/2023/04/25/Userfaultfd-在-ART-GC-上的应用/">Userfaultfd 在 ART GC 上的应用</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/20</span>
            <a class="archive-post-title" href="/2023/04/20/反碎片化-Proactive-compaction/">反碎片化 | Proactive compaction</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/17</span>
            <a class="archive-post-title" href="/2023/04/17/关于kswapd-并发的思考/">关于kswapd 并发的思考</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/06</span>
            <a class="archive-post-title" href="/2022/09/06/Android-图形栈疑问汇总-持续更新/">Android|图形栈疑问汇总(持续更新)</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span>
            <a class="archive-post-title" href="/2022/04/19/Android-S-Doze模式/">Android S Doze模式</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/20</span>
            <a class="archive-post-title" href="/2022/03/20/ART-虚拟机｜Dex2oat-调优实践之路/">ART 虚拟机｜Dex2oat 调优实践之路</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/01</span>
            <a class="archive-post-title" href="/2022/03/01/网络-拥塞控制算法之BBR/">网络 | 拥塞控制算法之BBR</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">02/10</span>
            <a class="archive-post-title" href="/2022/02/10/ANR原理分析及常见案例/">ANR原理分析及常见案例</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/27</span>
            <a class="archive-post-title" href="/2021/11/27/优化实践-高刷下列表滑动出现卡顿掉帧/">优化实践: 高刷下列表滑动出现卡顿掉帧</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/19</span>
            <a class="archive-post-title" href="/2021/11/19/优化实践-从系统层面优化应用启动速度/">优化实践:从系统层面优化应用启动速度</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/11</span>
            <a class="archive-post-title" href="/2021/11/11/Systrace角度-拆解分析应用的启动流程/">Systrace角度: 拆解分析应用的启动流程</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/08</span>
            <a class="archive-post-title" href="/2021/11/08/案例分析-切换应用后高概率操作无响应-Systrace/">案例分析:打开应用后操作界面无响应(Systrace)</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/01</span>
            <a class="archive-post-title" href="/2021/11/01/第三视角-一个ART-GC的优化故事/">第三视角: 一个ART GC的优化故事</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/27</span>
            <a class="archive-post-title" href="/2021/10/27/对Android-S-ART-GC的源码梳理/">对Android S ART GC的源码梳理</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span>
            <a class="archive-post-title" href="/2021/10/16/对进程压缩消费Zram速度的优化/">对进程压缩消费Zram速度的优化</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/18</span>
            <a class="archive-post-title" href="/2021/09/18/AMS锁严重竞争导致的整机卡顿/">AMS锁严重竞争导致的整机卡顿</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/08</span>
            <a class="archive-post-title" href="/2021/09/08/GC超时导致的后台应用崩溃问题分析/">GC超时导致的后台应用崩溃问题分析</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/30</span>
            <a class="archive-post-title" href="/2020/11/30/从tcpdump看miracast的play流程/">从tcpdump看miracast的play流程(工具篇)</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span>
            <a class="archive-post-title" href="/2020/11/25/一次SystemServer-OOM导致的系统重启分析之路/">一次SystemServer OOM导致的系统重启分析之路</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/20</span>
            <a class="archive-post-title" href="/2020/06/20/Memory-Barrier读书笔记/">内存屏障</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/04</span>
            <a class="archive-post-title" href="/2020/03/04/谁拖慢了列表的滑动速度/">谁拖慢了列表的滑动速度</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/23</span>
            <a class="archive-post-title" href="/2019/06/23/一个SharedPreferences写操作导致的ANR问题分析/">一个SharedPreferences写操作导致的ANR问题分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">04/12</span>
            <a class="archive-post-title" href="/2019/04/12/Launcher应用的重构之路/">Launcher应用的重构之路</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">03/11</span>
            <a class="archive-post-title" href="/2019/03/11/Android-系统层捕捉所有应用崩溃情况推送到钉钉实践之路/">Android 系统层捕捉所有应用崩溃情况推送到钉钉实践之路</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">06/06</span>
            <a class="archive-post-title" href="/2018/06/06/一个滑动冲突问题的分析流程/">一个滑动冲突问题的分析流程</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/2018/05/31/一个底层内存分配异常导致无法进入launcher问题分析/">一个底层内存分配异常导致无法进入launcher问题分析</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/29</span>
            <a class="archive-post-title" href="/2018/05/29/一个屏幕滑动无响应问题的分析流程/">一个屏幕滑动无响应问题的分析流程</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/17</span>
            <a class="archive-post-title" href="/2018/05/17/一个无法开机问题的分析流程/">一个无法开机问题的分析流程</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">05/14</span>
            <a class="archive-post-title" href="/2018/05/14/基于开源框架SlidingUpPanel二次开发/">基于开源框架SlidingUpPanel二次开发</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="kernel">
                <span class="iconfont-archer">&#xe606;</span>
                kernel
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="ANR">
            <span class="iconfont-archer">&#xe60a;</span>
            ANR
        </span>
    
        <span class="sidebar-category-name" data-categories="性能">
            <span class="iconfont-archer">&#xe60a;</span>
            性能
        </span>
    
        <span class="sidebar-category-name" data-categories="ART">
            <span class="iconfont-archer">&#xe60a;</span>
            ART
        </span>
    
        <span class="sidebar-category-name" data-categories="Android">
            <span class="iconfont-archer">&#xe60a;</span>
            Android
        </span>
    
        <span class="sidebar-category-name" data-categories="ebpf">
            <span class="iconfont-archer">&#xe60a;</span>
            ebpf
        </span>
    
        <span class="sidebar-category-name" data-categories="稳定性">
            <span class="iconfont-archer">&#xe60a;</span>
            稳定性
        </span>
    
        <span class="sidebar-category-name" data-categories="Linux">
            <span class="iconfont-archer">&#xe60a;</span>
            Linux
        </span>
    
        <span class="sidebar-category-name" data-categories="kernel，Android">
            <span class="iconfont-archer">&#xe60a;</span>
            kernel，Android
        </span>
    
        <span class="sidebar-category-name" data-categories="网络">
            <span class="iconfont-archer">&#xe60a;</span>
            网络
        </span>
    
        <span class="sidebar-category-name" data-categories="kernel">
            <span class="iconfont-archer">&#xe60a;</span>
            kernel
        </span>
    
        <span class="sidebar-category-name" data-categories="内存">
            <span class="iconfont-archer">&#xe60a;</span>
            内存
        </span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMeta = {
        url: "http://lihaizhou.top",
        root: "/",
        author: "Steven Li"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20210823"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20210823"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20210823" async></script>
        
        <!-- mermaid -->
        
    </body>
</html>
