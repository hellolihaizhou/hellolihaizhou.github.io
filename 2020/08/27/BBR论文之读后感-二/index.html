<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="ææµ·æ´²" type="application/atom+xml" />






<meta name="description" content="Characterizing the Bottleneck 12345A connection runs with the highest throughput and lowest delay when (rate balance) the bottleneck packet arrival rate equals BtlBw and (full pipe) the total data in">
<meta property="og:type" content="article">
<meta property="og:title" content="BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(äºŒ)">
<meta property="og:url" content="http://lihaizhou.top/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/index.html">
<meta property="og:site_name" content="ææµ·æ´²">
<meta property="og:description" content="Characterizing the Bottleneck 12345A connection runs with the highest throughput and lowest delay when (rate balance) the bottleneck packet arrival rate equals BtlBw and (full pipe) the total data in">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-1.png.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-2.png.png">
<meta property="og:image" content="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-3.png.png">
<meta property="og:updated_time" content="2020-08-27T04:52:38.647Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(äºŒ)">
<meta name="twitter:description" content="Characterizing the Bottleneck 12345A connection runs with the highest throughput and lowest delay when (rate balance) the bottleneck packet arrival rate equals BtlBw and (full pipe) the total data in">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-1.png.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lihaizhou.top/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/"/>





  <title>BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(äºŒ) | ææµ·æ´²</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	
	<!--<a href="https://github.com/hellolihaizhou" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>-->
	
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ææµ·æ´²</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äºæˆ‘
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lihaizhou.top/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Steven Lee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/background.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ææµ·æ´²">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(äºŒ)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2020-08-27T10:50:37+08:00">
                2020-08-27
              </time>
            

            

            
  	    
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ç½‘ç»œ/" itemprop="url" rel="index">
                    <span itemprop="name">ç½‘ç»œ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  2,258
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Characterizing the Bottleneck</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A connection runs <span class="keyword">with</span> the highest throughput and lowest delay when (rate balance) the bottleneck packet arrival rate equals BtlBw and (full pipe) the total data <span class="keyword">in</span> flight is equal to the BDP (= BtlBw Ã— RTprop).</span><br><span class="line"></span><br><span class="line">The first condition guarantees that the bottleneck can run at <span class="number">100</span> percent utilization. The second guarantees there is enough data to prevent bottleneck starvation but not overfill the pipe. The rate balance condition alone does not ensure there is no queue, only that it can<span class="string">'t change size (e.g., if a connection starts by sending its 10-packet Initial Window into a five-packet BDP, then runs at exactly the bottleneck rate, five of the 10 initial packets fill the pipe so the excess forms a standing queue at the bottleneck that cannot dissipate).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Similarly, the full pipe condition does not guarantee there is no queue (e.g., a connection sending a BDP in BDP/2 bursts gets full bottleneck utilization, but with an average queue of BDP/4). The only way to minimize the queue at the bottleneck and all along the path is to meet both conditions simultaneously.</span></span><br></pre></td></tr></table></figure>
<p><strong>ç¿»è¯‘ï¼š</strong></p>
<p>å½“ä¸€ä¸ªè¿æ¥æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå®ƒå¯ä»¥åœ¨è¾¾åˆ°æœ€é«˜çš„ååé‡çš„åŒæ—¶ä¿æŒæœ€ä½æ—¶å»¶ï¼š</p>
<ol>
<li>é€Ÿç‡å¹³è¡¡ï¼šç“¶é¢ˆå¸¦å®½çš„æ•°æ®åˆ°è¾¾é€Ÿç‡ä¸BtlBwç›¸ç­‰ï¼›</li>
<li>å¡«æ»¡ç®¡é“ï¼šæ‰€æœ‰çš„åœ¨å¤–æ•°æ®ï¼ˆinflight dataï¼‰ä¸BDPï¼ˆå¸¦å®½ä¸æ—¶å»¶çš„ä¹˜ç§¯ï¼‰ç›¸ç­‰</li>
</ol>
<p>å…¶ä¸­ç¬¬ä¸€ä¸ªçº¦æŸä¿è¯äº†ç“¶é¢ˆå¸¦å®½å¯ä»¥å¾—åˆ°100%åˆ©ç”¨ã€‚è€Œç¬¬äºŒä¸ªçº¦æŸä¿è¯äº†æµæœ‰è¶³å¤Ÿçš„æ•°æ®æ¥å¡«æ»¡ç“¶é¢ˆé“¾è·¯è€Œä¸”åŒæ—¶ä¸ä¼šæº¢å‡ºï¼ˆæ’é˜Ÿï¼‰ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ¡ä»¶æœ¬èº«å¹¶æ— æ³•ä¿è¯è·¯å¾„ä¸­ä¸å­˜åœ¨é˜Ÿåˆ—ï¼Œå®ƒåªèƒ½ä¿è¯æµçš„é€Ÿç‡ä¸å‘ç”Ÿæ”¹å˜ï¼ˆä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªè¿æ¥åœ¨ä¸€å¼€å§‹å°±å‘é€äº†10ä¸ªæŠ¥æ–‡åˆ°ä¸€ä¸ªBDPåªæœ‰5ä¸ªç½‘ç»œä¸­ï¼Œå¹¶ä¸”æ¥ä¸‹æ¥ä¸€ç›´ä¿æŒç“¶é¢ˆé€Ÿç‡å‘é€ã€‚è¿™æ ·å­ä¼šå¯¼è‡´åœ¨ä¸€å¼€å§‹å°±å¡«æ»¡äº†ç®¡é“ï¼Œå¹¶ä¸”åˆ¶é€ äº†5ä¸ªæŠ¥æ–‡çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”è¿™ä¸ªé˜Ÿåˆ—æ°¸è¿œä¸ä¼šè¢«æ¶ˆç­ï¼‰ã€‚</p>
<p>ç›¸ä¼¼åœ°ï¼Œç¬¬äºŒä¸ªæ¡ä»¶ä¹Ÿä¸èƒ½ä¿è¯é“¾è·¯ä¸­æ²¡æœ‰é˜Ÿåˆ—ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªè¿æ¥å¯ä»¥ä»¥burstæ–¹å¼å‘é€BDPæ•°é‡çš„æŠ¥æ–‡ï¼Œè‹¥è¯¥è¿æ¥æ¯æ¬¡å‘äºŒåˆ†ä¹‹ä¸€BDPæ¥è¾¾åˆ°ç“¶é¢ˆå¸¦å®½ï¼Œå¹¶ä¸”å‘ä¸¤æ¬¡ï¼Œæ­¤æ—¶full pipeæ¡ä»¶å¾—åˆ°æ»¡è¶³äº†ï¼Œç„¶è€Œç½‘ç»œä¸­çš„å¹³å‡é˜Ÿåˆ—é•¿åº¦æ˜¯BDP/4ã€‚ä¸ºäº†æœ€å°åŒ–ç½‘ç»œä¸­çš„é˜Ÿåˆ—é•¿åº¦ï¼Œå”¯ä¸€çš„æ–¹å¼æ˜¯åŒæ—¶æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ã€‚</p>
<p><strong>é¢å¤–æ·»åŠ ï¼š</strong></p>
<p>ä¸¤ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯ï¼Œå¦‚æœåªæ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå¯èƒ½ä¼šå‡ºç°å®é™…å‘é€æ•°æ®è¶…è¿‡BDPçš„æƒ…å†µï¼Œè¿™æ ·å°±ä¼šå‡ºç°æ’é˜Ÿï¼Œå¦‚æœåªæ»¡è¶³ç¬¬äºŒç‚¹çš„è¯ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ•°æ®åŒ…çªå‘çš„æƒ…å†µï¼Œå¯ä»¥ç†è§£ä¸ºä¸­é—´ç½‘ç»œè®¾å¤‡è½¬å‘å¤„ç†é€Ÿåº¦èµ¶ä¸ä¸Šå‘é€ç«¯å‘é€çš„é€Ÿåº¦äº†ï¼Œè¿™æ ·ä¹Ÿä¼šæœ‰æ’é˜Ÿã€‚<br>æ‰€ä»¥è¦æƒ³è¾¾åˆ°æœ€ä¼˜çš„æƒ…å†µï¼Œå°±æ˜¯åŒæ—¶æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ï¼Œå¤šä¹ˆç†æƒ³çš„æƒ³æ³•ï¼</p>
<p>BtlBw and RTprop vary over the life of a connection, so they must be continuously estimated. TCP currently tracks RTT (the time interval from sending a data packet until it is acknowledged) since itâ€™s required for loss detection. At any time t,</p>
<p><img src="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-1.png.png" alt=""></p>
<p>where ğ›ˆ â‰¥ 0 represents the â€œnoiseâ€ introduced by queues along the path, the receiverâ€™s delayed ack strategy, ack aggregation, etc. RTprop is a physical property of the connectionâ€™s path and changes only when the path changes. Since path changes happen on time scales Â» RTprop, an unbiased, efficient estimator at time T is</p>
<p><img src="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-2.png.png" alt=""></p>
<p>(i.e., a running min over time window WR (which is typically tens of seconds to minutes)</p>
<p><strong>ç¿»è¯‘ï¼š</strong></p>
<p>ç„¶è€Œï¼ŒBtlBwå’ŒRTpropåœ¨æ•´ä¸ªè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®æ—¶åœ°å¯¹å®ƒä»¬è¿›è¡Œä¼°è®¡ã€‚<br>ç›®å‰TCPä¸ºäº†æ£€æµ‹ä¸¢åŒ…ï¼Œå¿…é¡»å®æ—¶åœ°è·Ÿè¸ªRTTçš„å¤§å°ï¼ˆå‘é€æ•°æ®åˆ°æ”¶åˆ°è¿™ä¸ªåŒ…çš„ackçš„æ—¶é—´ï¼‰ï¼Œåœ¨ä»»æ„çš„æ—¶é—´t</p>
<p>å…¶ä¸­ï¼Œæœ€åä¸€é¡¹è¡¨ç¤ºâ€œå™ªå£°â€ã€‚é€ æˆå™ªå£°çš„å› ç´ ä¸»è¦æœ‰ï¼šé“¾è·¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ–¹çš„æ—¶å»¶ACKé…ç½®ï¼ŒACKèšåˆç­‰å› ç´ ç­‰å¾…ã€‚<br>RTpropæ˜¯è·¯å¾„çš„ç‰©ç†ç‰¹æ€§ï¼Œå¹¶ä¸”åªæœ‰è·¯å¾„å˜åŒ–æ‰ä¼šæ”¹å˜ã€‚ç”±äºä¸€èˆ¬æ¥è¯´è·¯å¾„å˜åŒ–çš„æ—¶é—´å°ºåº¦è¿œè¿œå¤§äºRTpropï¼ˆè¿™è¯´çš„æ˜¯å•¥ç©æ„ï¼Œå¾…ç†è§£ï¼‰<br>æ‰€ä»¥RTpropå¯ä»¥ç”±ä»¥ä¸‹å…¬å¼è¿›è¡Œä¼°è®¡ï¼š</p>
<p>ï¼ˆåœ¨ä¸€ä¸ªæ—¶é—´çª—å£ä¸­å¯¹RTTå–æœ€å°å€¼ã€‚ä¸€èˆ¬å°†è¯¥çª—å£å¤§å°è®¾ç½®ä¸ºå‡ åç§’è‡³å‡ åˆ†é’Ÿï¼‰</p>
<p>Unlike RTT, nothing in the TCP spec requires implementations to track bottleneck bandwidth, but a good estimate results from tracking delivery rate. When the ack for some packet arrives back at the sender, it conveys that packetâ€™s RTT and announces the delivery of data inflight when that packet departed. Average delivery rate between send and ack is the ratio of data delivered to time elapsed: deliveryRate = Î”delivered/Î”t. This rate must be â‰¤ the bottleneck rate (the arrival amount is known exactly so all the uncertainty is in the Î”t, which must be â‰¥ the true arrival interval; thus, the ratio must be â‰¤ the true delivery rate, which is, in turn, upper-bounded by the bottleneck capacity). Therefore, a windowed-max of delivery rate is an efficient, unbiased estimator of BtlBw: </p>
<p><img src="https://raw.githubusercontent.com/hellolihaizhou/saveImg/master/BBRpart2-3.png.png" alt=""></p>
<p>where the time window WB is typically six to ten RTTs.</p>
<p><strong>ç¿»è¯‘ï¼š</strong></p>
<p>ç„¶è€Œï¼Œbottleneck bandwidthçš„ä¼°è®¡ä¸åƒRTTé‚£æ ·æ–¹ä¾¿ï¼Œæ²¡æœ‰ä¸€ç§TCP specè¦æ±‚å®ç°ç®—æ³•æ¥è·Ÿè¸ªä¼°è®¡bottleneckå¸¦å®½ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è·Ÿè¸ªå‘é€é€Ÿç‡æ¥ä¼°è®¡bottleneckå¸¦å®½ã€‚<br>å½“å‘é€æ–¹æ”¶åˆ°ä¸€ä¸ªACKæŠ¥æ–‡æ—¶ï¼Œå®ƒå¯ä»¥è®¡ç®—å‡ºè¯¥æŠ¥æ–‡çš„RTTï¼Œå¹¶ä¸”ä»å‘å‡ºæŠ¥æ–‡åˆ°æ”¶åˆ°ackæŠ¥æ–‡è¿™æ®µæ—¶é—´çš„data Inflightã€‚è¿™æ®µæ—¶é—´å†…çš„å¹³å‡å‘é€é€Ÿç‡å°±å¯ä»¥ä»¥æ­¤è®¡ç®—å‡ºæ¥ï¼šdeliveryRate = delta delivered/ delta tã€‚è¿™ä¸ªè®¡ç®—å‡ºçš„é€Ÿç‡å¿…å®šå°äºbottlenecké€Ÿç‡ï¼ˆå› ä¸ºdelta deliveredæ˜¯ç¡®å®šçš„ï¼Œä½†æ˜¯delta tä¼šè¾ƒå¤§ï¼‰ã€‚å› æ­¤ï¼ŒBtwBwå¯ä»¥æ ¹æ®ä»¥ä¸‹å…¬å¼è¿›è¡Œä¼°è®¡</p>
<p>å…¶ä¸­ï¼Œæ—¶é—´çª—å£å¤§å°çš„å€¼ä¸€èˆ¬ä¸º6~10ä¸ªRTTã€‚</p>
<p><strong>é¢å¤–å¢åŠ ï¼š</strong><br>è¿™é‡Œæåˆ°äº†BBRçš„deliveryRateçš„è®¡ç®—æ–¹å¼ï¼Œè¿™ä¸ªå…¬å¼çœ‹èµ·æ¥æ˜¯å¦‚æ­¤çš„ç®€å•<br>1).åº”ç­”äº†å¤šå°‘æ•°æ®ï¼Œè®°ä¸ºdeliveredï¼›<br>2).åº”ç­”1)ä¸­çš„deliveredè¿™ä¹ˆå¤šæ•°æ®æ‰€ç”¨çš„æ—¶é—´ï¼Œè®°ä¸ºinterval_usã€‚<br>å°†ä¸Šè¿°äºŒè€…ç›¸é™¤ï¼Œå°±èƒ½å¾—åˆ°å¸¦å®½ï¼š<code>bw = delivered/interval_us</code><br>è¿™é‡Œçš„deliveredåªå…³æ³¨æ•°æ®çš„å¤§å°ï¼Œä¸å…³æ³¨æ•°æ®çš„å«ä¹‰ï¼Œæ¯”å¦‚deliveredçš„é‡‡é›†ä¸­ï¼Œbbræ ¹æœ¬ä¸ç®¡æŸä¸€ä¸ªåº”ç­”æ˜¯é‡ä¼ åçš„ACKç¡®è®¤çš„ï¼Œæ­£å¸¸ACKç¡®è®¤çš„ï¼Œè¿˜æ˜¯è¯´SACKç¡®è®¤çš„ã€‚bbråªå…³å¿ƒè¢«åº”ç­”äº†å¤šå°‘ï¼<br>è‡³äºä¸ºä»€ä¹ˆèƒ½å¤Ÿä¸å…³æ³¨æ•°æ®çš„å«ä¹‰ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<br><a href="https://blog.csdn.net/dog250/article/details/52830576" target="_blank" rel="noopener">æ¥è‡ªGoogleçš„TCP BBRæ‹¥å¡æ§åˆ¶ç®—æ³•è§£æ</a><br>æŒ‰ç…§è¿™ä¸ªå…¬å¼çš„è®¡ç®—æ–¹å¼å…¶å®æ˜¯å®Œå…¨å¿½ç•¥äº†ç³»ç»Ÿå±‚é¢çš„TCPçŠ¶æ€ï¼Œè®¡ç®—å¸¦å®½æ—¶å®ƒä»…ä»…éœ€è¦ä¸¤ä¸ªå€¼å°±å¤Ÿäº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TCP must record the departure time <span class="keyword">of</span> each packet to compute RTT. BBR augments that record <span class="keyword">with</span> the total data delivered so each ack arrival yields both an RTT and a delivery rate measurement that the filters convert to RTprop and BtlBw estimates.</span><br><span class="line"></span><br><span class="line">Note that these values are completely independent: RTprop can change (<span class="keyword">for</span> example, on a route change) but still have the same bottleneck, or BtlBw can change (<span class="keyword">for</span> example, when a wireless link changes rate) without the path changing. (This independence is why both constraints have to be known to match sending behavior to delivery path.) Since RTprop is visible only to the left <span class="keyword">of</span> BDP and BtlBw only to the right <span class="keyword">in</span> figure <span class="number">1</span>, they obey an uncertainty principle: whenever one can be measured, the other cannot. Intuitively, <span class="keyword">this</span> is because the pipe has to be overfilled to find its capacity, which creates a queue that obscures the length <span class="keyword">of</span> the pipe. For example, an application running a request/response protocol might never send enough data to fill the pipe and observe BtlBw.</span><br><span class="line"></span><br><span class="line">A multi-hour bulk data transfer might spend its entire lifetime <span class="keyword">in</span> the bandwidth-limited region and have only a single sample <span class="keyword">of</span> RTprop <span class="keyword">from</span> the first packet<span class="string">'s RTT. This intrinsic uncertainty means that in addition to estimators to recover the two path parameters, there must be states that track both what can be learned at the current operating point and, as information becomes stale, how to get to an operating point where it can be relearned.</span></span><br></pre></td></tr></table></figure>
<p><strong>ç¿»è¯‘ï¼š</strong></p>
<p>TCPå¿…é¡»è®°å½•æ¯ä¸ªæŠ¥æ–‡çš„ç¦»å¼€æ—¶é—´ä»è€Œè®¡ç®—RTTã€‚BBRå¿…é¡»é¢å¤–è®°å½•å·²ç»å‘é€çš„æ•°æ®å¤§å°ï¼Œä½¿å¾—åœ¨æ”¶åˆ°æ¯ä¸€ä¸ªACKä¹‹åï¼Œè®¡ç®—RTTåŠå‘é€é€Ÿç‡çš„å€¼ï¼Œæœ€åå¾—åˆ°RTpropå’ŒBtlBwçš„ä¼°è®¡å€¼ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªå€¼æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼šRTpropå¯ä»¥å‘ç”Ÿå˜åŒ–ç„¶è€Œä¿æŒbottleneckä¸å˜ï¼ˆæ¯”å¦‚å‘ç”Ÿè·¯ç”±å˜åŒ–ï¼‰ï¼Œæˆ–è€…BtlBwå¯ä»¥å˜åŒ–è€Œè·¯å¾„ä¸å˜ï¼ˆæ¯”å¦‚æ— çº¿é“¾è·¯é€Ÿç‡å‘ç”Ÿå˜åŒ–ï¼‰ã€‚ï¼ˆThis independence is why both constraints have tobe known to match sending behavior to delivery path.ï¼‰</p>
<p>å¦‚å›¾1æ‰€ç¤ºï¼Œåªæœ‰åœ¨BDPçš„å·¦è¾¹ï¼Œæ‰èƒ½è§‚æµ‹åˆ°RTpropï¼Œå¹¶ä¸”åªæœ‰åœ¨BDPçš„å³è¾¹æ‰èƒ½è§‚æµ‹åˆ°BtlBwï¼Œä»–ä»¬éµå¾ªäº†ä¸€ä¸ªä¸ç¡®å®šæ€§åŸåˆ™ï¼šå½“å…¶ä¸­ä¸€ä¸ªå¯ä»¥è¢«è§‚æµ‹çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªå¹¶ä¸èƒ½ã€‚ç›´è§‰åœ°ï¼Œè¿™æ˜¯å› ä¸ºä¸ºäº†è§‚æµ‹å‡ºç®¡é“çš„å®¹é‡ï¼Œå¿…é¡»å¡«æ»¡ç®¡é“ï¼Œè€Œè¿™ä¼šåˆ›é€ å‡ºä¸€ä¸ªé˜Ÿåˆ—ä»è€Œæ— æ³•è§‚æµ‹åˆ°ç®¡é“çš„é•¿åº¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªä½¿ç”¨request/responseåè®®çš„åº”ç”¨å¯èƒ½æ°¸è¿œä¸ä¼šå‘é€è¶³å¤Ÿçš„æ•°æ®æ¥å¡«æ»¡ç®¡é“ï¼Œå¹¶ä¸”è§‚æµ‹åˆ°BtlBwã€‚ä¸€ä¸ªæŒç»­å‡ ä¸ªå°æ—¶çš„å¤§æ–‡ä»¶ä¼ è¾“åº”ç”¨å¯èƒ½æ°¸è¿œå¤„åœ¨bandwidth-limitedåŒºåŸŸï¼Œè€Œä»…ä»…åœ¨ç¬¬ä¸€ä¸ªæŠ¥æ–‡ä¸­çš„RTTé‡‡é›†åˆ°RTpropã€‚è¿™ç§ä¸ç¡®å®šæ€§æœºåˆ¶æ„å‘³ç€ï¼Œåœ¨ä¿¡æ¯å˜å¾—ä¸æ˜ç¡®çš„æ—¶å€™ï¼Œå¿…é¡»è¦æœ‰æœºåˆ¶æ¥ä»å½“å‰çš„å·¥ä½œçŠ¶æ€ä¸­å­¦ä¹ åˆ°è¿™ä¸¤ä¸ªå€¼çš„å…¶ä¸­ä¸€ä¸ªï¼Œå¹¶ä¸”è¿›å…¥å¯¹åº”çš„å·¥ä½œåŒºæ¥é‡æ–°å­¦ä¹ è¿™ä¸¤ä¸ªå€¼ã€‚</p>
<p>ä¸‹ä¸€ç¯‡è®²è¿›å…¥å…¬å¼çš„ç»†èŠ‚éƒ¨åˆ†</p>

      
    </div>
    
    
    
	
	<div>
	  
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>è¯·å¤šå¤šæŒ‡æ•™-------------</div>
    
</div>

      
    </div>
	
    
	
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
    Steven Lee
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://lihaizhou.top/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/" title="BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(äºŒ)">http://lihaizhou.top/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-äºŒ/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-ä¸€/" rel="next" title="BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(ä¸€)">
                <i class="fa fa-chevron-left"></i> BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(ä¸€)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/27/BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ-ä¸‰/" rel="prev" title="BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(ä¸‰)">
                BBRè®ºæ–‡ä¹‹è¯»åæ„Ÿ(ä¸‰) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/background.jpg"
                alt="Steven Lee" />
            
              <p class="site-author-name" itemprop="name">Steven Lee</p>
              <p class="site-description motion-element" itemprop="description">æææƒšæƒš</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Steven Lee</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  æœ¬ç«™è®¿å®¢æ•°:<span id="busuanzi_value_site_uv"></span>
</span>
</div>




  <span class="post-meta-divider">|</span>





<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">Stevençš„åšå®¢å…±80.8kå­—</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'Hsz9zOlrvMN9ry0R9Jfi5ykJ-gzGzoHsz',
        appKey: 'MAHOS3RIF7wDFRbEeC7kf3Vr',
        placeholder: 'æ­¤å¤„è¾“å…¥è¯„è®ºå†…å®¹',
        avatar:'wavatar',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
